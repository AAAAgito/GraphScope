g.timeout(600000).V().hasLabel('person').has('id', $personId).as('root').out('knows').union(identity(), out('knows')).dedup().has('id', neq($personId)).as('friends').outE('workAt').has('workFrom', lt($workFromYear)).as('startWork').values('workFrom').as('works').select('startWork').inV().as('comp').values('name').as('orgname').select('comp').out('isLocatedIn').has('name','$countryName').select('friends').order().by(select('works'), asc).by('id', desc).by(select('orgname'), desc).limit(10).select('friends', 'orgname', 'works').by(valueMap('id', 'firstName', 'lastName')).by().by()